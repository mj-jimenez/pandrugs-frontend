<div>
<button type="submit" class="btn btn-success btn-lg" ng-show="results!=null" ng-click="newQuery()" style="float:right">New Query</button>
<h2>Query PandrugsDB: Genes</h2>

</div>

<form role="query form">
  <div class="container-fluid">
    <div class="row"  id="genequeryform" ng-show="results==null">
    <div class="col-md-6">
  <div class="form-group">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h4 class="panel-title">
          Genes
      </h4>
    </div>
    <textarea name="genes" class="form-control" id="genestextarea" placeholder="Enter HUGO Gene symbols" ng-model="genes" rows="20"></textarea>
  </div>
  </div>
  </div>
  <div class="col-md-6">
  <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#/query#advanced" aria-expanded="true" aria-controls="advanced">
          Advanced Options
        </a>
      </h4>
    </div>
    <div id="advanced" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
      
      <!-- drug and status level-->
      <div class="panel panel-default">      
	<div class="panel-heading">Drug status level</div>
	<div class="panel-body">
	
	  <h4>Cancer</h4>	
	    <label><input type="checkbox" ng-model="queryCancerFda">FDA approved</label>
	    <label><input type="checkbox" ng-model="queryCancerClinical">Clinical trials</label>	
	  <h4>Other pathologies</h4>	
	    <label><input type="checkbox" ng-model="queryOtherFda">FDA approved</label>	
	    <label><input type="checkbox" ng-model="queryOtherClinical">Clinical trials</label>	
	    <label><input type="checkbox" ng-model="queryOtherExperimental">Experimental</label>
	  
	</div><!-- end panel-body -->
      
      </div><!-- end drug and status level -->
     
      
      <!-- interaction evidence level -->
      <div class="panel panel-default">      
	<div class="panel-heading">Interaction evidence level</div>
	<div class="panel-body">
	    <label><input type="checkbox" ng-model="queryTarget">Target</label>
	
	    <label><input type="checkbox" ng-model="queryMarker">Marker</label>
	</div><!-- end panel-body -->
      </div><!-- end  interaction evidence level -->
      
      <!-- drug-target relation -->
      <div class="panel panel-default">      
	<div class="panel-heading">Drug-target relation</div>
	<div class="panel-body">
	    <label><input type="checkbox" ng-model="queryDirect">Direct</label>
	
	    <label><input type="checkbox" ng-model="queryIndirect">Indirect</label>
	</div><!-- end panel-body -->
      </div><!-- end  interaction evidence level -->
      
      </div>
    </div>
  </div>
  </div>
  </div>
</div>


  <button type="submit" class="btn btn-primary btn-lg" ng-show="results==null" ng-click="query()" ng-disabled="genes.length==0 || isLoading || (!queryCancerFda && !queryCancerClinical && !queryOtherClinical && !queryOtherExperimental && !queryOtherFda) || (!queryTarget && !queryMarker) || (!queryDirect && !queryIndirect)">Query</button>
  
</form>


<div id="resultsContainer" class="container-fluid" ng-if="results!=null && results.length != 0">
<h3>PanDrugs Candidate Therapies</h3>
  <highchart id="chart1" config="highchartsBubble" style="margin-top:20px"></highchart>

<table id="results" st-table="results" st-pipe="query" class="table table-striped">
	<thead>
	<tr>
		<th>Actions</th>
		<th>Gene(s) <span class="gene_icon" title="Gene"/> <span class="help_icon" title="Gene(s) is ... under construction"/></th>
		<th>Drug <span class="drug_icon" title="Drug"/> <span class="help_icon" title="Drug is ... under construction"/></th>
		<th>Family <span class="help_icon" title="Family is ... under construction"/></th>
		<th>Source(s) <span class="help_icon" title="Source(s) is ... under construction"/></th>
		<th>Drug status <span class="help_icon" title="Drug status is ... under construction"/></th>
		<th st-sort="therapy">Type of therapy <span class="help_icon" title="Types of therapy is ... under construction"/></th>
		<th>Interaction <span class="help_icon" title="Interaction is ... under construction"/></th>
		<th>Target <span class="help_icon" title="Target is ... under construction"/></th>
		<th st-sort="dScore">DScore <span class="help_icon" title="DScore is ... under construction"/></th>
		<th st-sort="gScore">GScore <span class="help_icon" title="GScore is ... under construction"/></th>
	</tr>
	</thead>
	<tbody ng-hide="isLoading" ng-repeat="row in results">
	<tr>
		<td>
		<button class="btn btn-default" ng-click="row.moreinfo=!row.moreinfo">
		  <span ng-show="row.moreinfo" class="glyphicon glyphicon-minus"></span>
		  <span ng-show="!row.moreinfo" class="glyphicon glyphicon-plus"></span>
		</button></td>
		<td ng-bind-html="row.gene | enumerationWithLink : 'http://www.ncbi.nlm.nih.gov/gene?term=[VALUE]' : true : '\\[VALUE\\]'"></td>
		<td>{{row['show-drug-name']}}</td>
		<td>{{row.family | enumeration }}</td>
		<td>
		<span ng-repeat="source in row.source"><a href="{{source.link}}" target="_blank" title="{{source.name}}" ng-class="row['curated-source'].indexOf(source.name) != -1 ? 'curated_source' : 'non_curated_source'">{{source.shortName}}</a></span>
		</td>
		<td>{{row.status | replace:'_':' ' |titlecase}}{{row.cancer.length>0?' for ':''}}{{row.cancer |enumeration | replace:'_':' '|lowercase}}</td>
		<td>{{row.therapy?row.therapy:'' | titlecase | replace:'_':' '}}</td>
		<td><img src="images/query/{{row['indirect-gene'].length == 0 ? 'direct-interaction.png' : 'indirect-interaction.png'}}"/></td>
		<td>{{row.target?'yes':'-'}}</td>
		<td>{{row.dScore | number: 4}}</td>
		<td>{{row.gScore | number: 4}}</td>		
	</tr>	
	<tr ng-repeat="genedrug in row['gene-drug-info']" ng-show="row.moreinfo" class="moreinfo">
	  <td>&nbsp;</td>
	  <td colspan="2">
	   <div ng-show="{{genedrug.drugStatusInfo.length>0}}">{{genedrug.drugStatusInfo}}</div>
	    <strong ng-bind-html="genedrug.gene | enumerationWithLink : 'http://www.ncbi.nlm.nih.gov/gene?term=[VALUE]' : true : '\\[VALUE\\]'"></strong><br>
	    PubMed Link: 
	    <a target="_blank" href='http://www.ncbi.nlm.nih.gov/pubmed/?term=&quot;{{genedrug.indirect!=null?(genedrug.drug+"\"+\""+genedrug.indirect):(genedrug.drug+"\"+\""+genedrug.gene.join())}}&quot;'>{{genedrug.indirect!=null?(genedrug.drug+'+'+genedrug.indirect):(genedrug.drug+'+'+genedrug.gene.join())}}</a>
	    
	    <br>
	    Sensitivity: {{genedrug.sensitivity}} <br>
	    Alteration: {{genedrug.alteration}}
	  </td>
	  <td >{{genedrug.family}}</td>
	  <td >{{genedrug.source.join(', ')}}</td>
	  <td colspan="2">&nbsp;</td>
	  <td><img src="images/query/{{genedrug.indirect == null ? 'direct-interaction.png' : 'indirect-interaction.png'}}"/></td>
	  <td >{{genedrug.target}}</td>
	  <td >{{genedrug.dScore | number: 4}}</td>
	  <td >{{genedrug.gScore | number: 4}}</td>
	</tr>
	</tbody>
	
	<tbody ng-hide="!isLoading">
	<tr>
	<td colspan="10">Loading...</td>
	</tr>
	</tbody>
</table>

</div>
</div>

