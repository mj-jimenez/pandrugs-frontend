<div>
  <button type="submit" class="btn btn-primary btn-lg" ng-show="results != null" ng-click="newQuery()" style="float:right">New Query</button>
  <h2>Query PanDrugs</h2>
</div>
<form role="query form">
  <div class="container-fluid">
    <div class="row"  id="genequeryform" ng-show="results==null">
      <div class="col-md-6">
        <div class="form-group">
          <div class="panel panel-default">
            <ul class="nav nav-tabs" role="tablist">
              <li ng-class="{active:getComputationIdQuery() === undefined}" role="presentation" ng-click="setSelectedTab('genes')">
                <a href="/query#genes" aria-controls="genes" data-toggle="tab" role="tab">Genes</a>
              </li>
              <li role="presentation" ng-click="setSelectedTab('drugs')">
                <a href="/query#drugs" aria-controls="drugs" data-toggle="tab" role="tab">Drugs</a>
              </li>
              <li role="presentation" ng-click="setSelectedTab('generank')">
                <a href="/query#generanking" aria-controls="gene-rank" data-toggle="tab" role="tab">Gene Ranking</a>
              </li>
              <li ng-class="{active:getComputationIdQuery() !== undefined}" role="presentation" ng-click="setSelectedTab('vcfranking')">
                <a href="/query#vcfranking" aria-controls="vcf-rank" data-toggle="tab" role="tab">Genomic Variants</a>
              </li>
            </ul>

            <div class="tab-content panel-body">
              <div id="genes" class="tab-pane"  ng-class="{active:getComputationIdQuery()==undefined}">
                <div class="alert alert-info">
                  Provide a gene list (HUGO Gene Symbols) to retrieve PanDrugs therapeutic candidates. Supply one gene
                  symbol per each line.
                </div>

                <button class="btn btn-default" data-toggle="collapse" data-target="#examples-zone">Use an example</button>
                <div id="examples-zone" class="collapse">
                  <div id="sample-gene-list">
                    <div id ="sample-1">
                      <button class="btn btn-default" ng-click="pasteStomachCarcinomaExample()">Load Example 1</button>
                      <span class="cite">Genes significantly mutated in Stomach Adenocarcinoma (TCGA, Nature 2014)</span>
                    </div>
                    <div id ="sample-2">
                      <button class="btn btn-default" ng-click="pasteAngiogenesisExample()">Load Example 2</button>
                      <span class="cite">Genes involved in Angiogenesis</span>
                    </div>
                    <div id ="sample-3">
                      <button class="btn btn-default" ng-click="pasteSignalingPathwayExample()">Load Example 3</button>
                      <span class="cite">Genes involved in PI3K-AKT-mTOR signaling pathway</span>
                    </div>
                  </div>
                </div>

                <textarea name="genes" id="genestextarea" class="form-control" placeholder="Enter HUGO Gene symbols"
                          ng-model="genes" rows="20" spellcheck="false" smart-area="genesTextAreaConfig"></textarea>
              </div>

              <div id="drugs" class="tab-pane">
                <div class="alert alert-info">
                  <p>
                    This query allows to explore the drug-gene relationships available in PanDrugs database.
                  </p>
                  <p>
                    <strong>Example: </strong>Palbociclib
                  </p>
                </div>

                <input ng-model="drugQuery" class="form-control" placeholder="Enter a drug name" spellcheck="false"/>
                <list-group items="drugItems" selected-items="drugs" selectable="true" template-url="drugTemplateUrl" ng-if="!loadingDrugs" />
              </div>

              <div id="generanking" class="tab-pane form-group" role="tabpanel" onselect="alert('tab2')">
                <div class="alert alert-info">
                  <p>
                    Upload a ranked list of genes in the <strong><a
                    href="http://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#RNK:_Ranked_list_file_format_.28.2A.rnk.29"
                    target="_blank">RNK file format</a></strong>
                    to execute this query.
                  </p>
                  <p>
                    You can download a ranked list example (Lung adenocarcinoma LUAD patient with EGFR mutation and
                    amplification from TCGA) from <strong><a href="downloads/TCGA-91-6847.rnk" target="_blank">here</a></strong>.
                  </p>
                </div>

                <label for="generankinput">Select a gene ranking file</label>
                <input name="generank" id="generankinput" class="file" type="file" file-model="generank"/>

                <script>$(document).ready(function() {
                  $("#generankinput").fileinput({'showUpload':false, 'showRemove': false, 'previewFileType':'any', 'multiple':false});
                }); </script>
              </div>

              <div id="vcfranking" class="tab-pane form-group" ng-class="{active:getComputationIdQuery()!=undefined}" role="tabpanel">
                <div class="alert alert-info">
                  <p>
                    Upload a <strong><a href="https://en.wikipedia.org/wiki/Variant_Call_Format" target="_blank">VCF
                    file</a></strong>
                    to execute this query.
                  </p>
                  <p>
                    <strong>WARNING</strong>: genomic coordinates <strong>MUST BE</strong> expressed in the human genome
                    HG19 assembly.
                  </p>
                </div>

                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#newComputationModal">
                  New variants analysis...
                </button>
                <div id = "newComputationModal" class="modal fade" tabindex="-1" role="dialog">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">New variants analysis</h4>
                      </div>
                      <div class="modal-body">
                        <fieldset class="form-group">
                          <label for="generankinput">Select a variants file (in <a href="http://www.internationalgenome.org/wiki/Analysis/vcf4.0/">VCF format</a>). <strong>Note:</strong>
                          The genome positions must be accordiyng to the GRCh37/hg19 human genome assembly</label>
                          <div>
                            <input name="vcffile" id="vcfinput" class="form-control" type="file" file-model="vcffile"/>
                            <script>$(document).ready(function() {
                              $("#vcfinput").fileinput({'showUpload':false, 'showRemove': false, 'previewFileType':'any', 'multiple':false});
                            }); </script>
                            <a href="downloads/TCGA-BF-A1PU-01A-11D-A19A-08.vcf">Download a VCF example file</a> (Melanoma patient BRAF mutant from TCGA)
                          </div>
                          <label for="computationNameInput">Computation name</label>
                          <input name="computationName" id="computationNameInput" class="form-control" type="text" ng-model="computationName"/>
                          <!--<input type="button" class="btn btn-success" value="Submit VCF to analyze" ng-click="submitVCF()" />-->
                        </fieldset>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button ng-disabled="vcffile == '' || computationName.length == 0" type="button" class="btn btn-success" data-dismiss="modal" ng-click="submitVCF()">Submit VCF</button>
                      </div>
                    </div><!-- /.modal-content -->
                  </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
                <div class="panel panel-default" ng-show="keys(computations).length > 0 && getCurrentUser() !== 'anonymous'">
                  <div class="panel-heading" role="tab" id="headingVCFSubmit">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-parent="#accordion" aria-expanded="true" aria-controls="computationselect">
                        Your variant analyses
                      </a>
                    </h4>
                  </div>
                  <div id="computationSubmit" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="computationselect">
                    <div class="panel-body">
                      Select one of your analysis to do the Query
                      <div ng-repeat="(id, status) in computations" >
                        <div class="radio">
                          <label>
                            <input ng-disabled="!status.finished || status.failed || status.affectedGenes.length == 0" type="radio" name = "computationid" ng-model="$parent.computationId" ng-value="id"/>
                            {{status.name}}
                          </label>
                          <span class="affectedGenes" ng-show="status.affectedGenes != null" ng-class="{error: status.affectedGenes.length == 0}">[{{status.affectedGenes.length}} affected genes]</span>
                          <input ng-show="status.finished" type="button" class="deleteButton btn btn-danger" ng-click="deleteComputation(id)" value="Delete"/>
                          <img ng-show="!status.finished" src="images/spinner.gif" width = "20px">
                        </div>
                        <div class="progress">
                          <div ng-class="{'progress-bar': true, error: status.failed, success: status.finished && !status.failed}" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" style="width:{{status.overallProgress | percentage: 0}}">
                              {{status.taskName}}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div ng-show="keys(computations).length > 0 && getCurrentUser() === 'anonymous'">
                  <div ng-repeat="(id, status) in computations" >
                    <div class="radio">
                      <img ng-show="!status.finished" src="images/spinner.gif" width = "20px">{{status.name}} (id: {{id}})<br>
                      <span class="affectedGenes" ng-show="status.affectedGenes != null" ng-class="{error: status.affectedGenes.length == 0}">[{{status.affectedGenes.length}} affected genes]</span>

                    </div>
                    <div class="progress">
                      <div ng-class="{'progress-bar': true, error: status.failed, success: status.finished && !status.failed}" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" style="width:{{status.overallProgress | percentage: 0}}">
                          {{status.taskName}}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6" ng-show="selectedTab != 'drugs'">
        <advanced-query-options on-change="updateAdvancedQueryOptions(options)"/>
      </div>
    </div>
    <button type="submit" class="btn btn-success btn-lg" ng-show="results == null" ng-click="query()"
    ng-disabled="(selectedTab == 'genes' && genes.length == 0) || (selectedTab == 'drugs' && drugs.length == 0) || (selectedTab == 'generank' && generank.length == 0) || isLoading || !advancedQueryOptions.isValid() || (selectedTab =='vcfranking' && computationId=='')" >Query</button>
  </div>
</form>
<div id="resultsContainer" class="container-fluid" ng-if="results!=null">
  <div class="row">
    <h3>PanDrugs Candidate Therapies</h3>

  </div>
  <div class="row">
    <div class="col-md-10 col-lg-8 col-md-push-1 col-lg-push-2" id="results-summary" ng-show="selectedTab !== 'drugs'">

      <div class="row">
        <div class="col-md-4" ng-show="selectedTab === 'genes'">
          <h4 class="row">GENES</h4>
          <table>
            <tr>
              <th>No. input genes</th><td>{{parsedInputGenes.length}}</td>
            </tr>
            <tr>
              <th>No. genes in PanDrugs</th><td>{{genespresence.present.length}}</td>
            </tr>
            <tr>
              <th>No. genes not in PanDrugs</th><td>{{genespresence.absent.length}}</td>
            </tr>
          </table>

        </div>
        <div class="col-md-4" ng-show="selectedTab === 'generank'">
          <h4 class="row">GENE Rank</h4>
          <table>
            <tr>
              <th>Input file</th><td>{{generank.name}}</td>
            </tr>
            <tr>
              <th>No. input genes</th><td>{{parsedInputGenes.length}}</td>
            </tr>
            <tr>
              <th>No. genes in PanDrugs</th><td>{{genespresence.present.length}}</td>
            </tr>
            <tr>
              <th>No. genes not in PanDrugs</th><td>{{genespresence.absent.length}}</td>
            </tr>
          </table>
        </div>
        <div class="col-md-4" ng-show="selectedTab === 'vcfranking'">
          <h4 class="row">Genomic variants</h4>
          <table>
            <tr>
              <th>Name</th><td>{{computations[computationId].name}}</td>
            </tr>
            <tr>
              <th>No. variants</th><td>{{computations[computationId].variantsInInput}}</td>
            </tr>
            <tr>
              <th>No. affected genes</th><td>{{computations[computationId].affectedGenes.length}}</td>
            </tr>
            <tr>
              <th>No. genes in PanDrugs</th><td>{{genespresence.present.length}}</td>
            </tr>
            <tr>
              <th>No. genes not in PanDrugs</th><td>{{genespresence.absent.length}}</td>
            </tr>
          </table>
        </div>
        <div class="col-md-8">
          <div class="row">
              <h5>SELECTED OPTIONS</h5>
              <div class="col-md-6">
                  <h6>Drug status level</h6>
                  <p ng-if="queryCancerFda">FDA approved cancer</p>
                  <p ng-if="queryCancerClinical">Clinical trials cancer</p>
                  <p ng-if="queryOtherFda">FDA approved other patologies</p>
                  <p ng-if="queryOtherClinical">Clinical trials other pathologies</p>
                  <p ng-if="queryOtherExperimental">Experimental</p>

              </div>
              <div class="col-md-6">
                  <h6>Interaction evidence level</h6>
                  <p ng-if="queryTarget">Target</p>
                  <p ng-if="queryMarker">Marker</p>
                  <h6>Selected cancer types</h6>
                  <ul ng-if="!allCancerSelected()">
                  <li class="cancer_type_checkbox" ng-repeat="cancerType in selectedCancerTypes">
                    {{cancerType | replace:'_':' ' | titlecase}}
                  </li>
                  </ul>
                  <p ng-if="allCancerSelected()">All</p>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row" ng-if="results!=null && results.length==0">
    Sorry, no results for your query have been found.
  </div>
  <div class="row" ng-if="selectedTab !== 'drugs'">
    <!--<div class="panel panel-default">
      <ul class="nav nav-tabs" role="tablist">
        <li class="active" role="presentation" ng-click="setSelectedTab('charts')">
          <a href="/query#charts" aria-controls="charts" data-toggle="tab" role="tab">Charts</a>
        </li>
        <li role="presentation" ng-click="setSelectedTab('network')">
          <a href="/query#network" aria-controls="network" data-toggle="tab" role="tab">Network</a>
        </li>
      </ul>

      <div class="tab-content panel-body">
        <div id="charts" class="tab-pane active">-->
          <div class="row" ng-if="results!=null && results.length>0">
            <div class="col-lg-7">
              <highchart id="therapiesChart" config="highchartsBubble" style="margin-top:20px"></highchart>
            </div>
            <div class="col-lg-5">
              <highchart id="therapyByStatusChart" config="highchartsTherapyByStatus" style="margin-top:20px"></highchart>
              <highchart id="therapyByFamilyChart" config="highchartsTherapyByFamily" style="margin-top:20px"></highchart>
            </div>
          </div>
        <!--</div>
        <div id="network" class="tab-pane form-group" role="tabpanel" onselect="alert('tab2')">
          <div class="row">
            <div>
              <h4>Network Graph of best candidates</h4>
              <form>
              <input type="checkbox" ng-model="networkparams.showInteractions" ng-change="updateNetworkChart()">show interactions
            </form>
              <a ng-click="exportnetwork()" download="network.png" href="{{pngcontent}}">Download image</a>
              <div id="chartarea">
                <div ng-hide="networkChartLoading" id="genedrugnetworkgraph"></div>
                <div ng-show="networkChartLoading" id="loading-banner"><img src="images/spinner.gif"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>-->
  </div>

  <div class="row"  ng-if="results!=null && results.length>0">
    <a id="download-csv-link" href="{{csvcontent}}" download="data.csv"><button class="btn btn-primary">Download as CSV</button></a>

    <table id="results" st-table="results" st-pipe="query" class="table table-striped query-table">
      <thead>
        <tr>
          <th ng-if="selectedTab !== 'drugs'">Actions</th>
          <th><span class="gene">Gene(s)</span> </span> <span class="help_icon" title="gene(s) from the input list with a match in the database related to the proposed therapy"></span></th>
          <th><span class="drug">Drug</span> </span> <span class="help_icon" title="compound name"></span></th>
          <th>Drug status <span class="help_icon" title="FDA approval status of the drug and the cancer prescription for the approved ones"/></th>
          <th st-sort="therapy" style="cursor: pointer" title="click to sort">Type of therapy <span class="help_icon" title="type of therapy for the approved drugs in cancer"/></th>
          <th>R/S <span class="help_icon" title="Resistance or sensitivity of the gene/s to the drug"/></th>
          <th>Interaction <span class="help_icon" title="type of relation between the genes and the drugs. Options are Direct (target or marker) or Indirect (pathway search based)"/></th>
          <th>Family <span class="help_icon" title="drug family based on the KEGG target-based classification of drugs"/></th>
          <th>Source(s) <span class="help_icon" title="source(s) where the drug-gene interaction came from"/></th>
          <th st-sort="dScore" style="cursor: pointer" st-sort-default="reverse">DScore <span class="help_icon" title="score for the suitability of the drug based on approval status, use in cancer, drug-target relation, number of associated genes and curation level of the sources"/></th>
          <th st-sort="gScore" style="cursor: pointer">GScore <span class="help_icon" title="score for the gene representing the biological relevance of the gene in the tumoral process"/></th>
          <th></th>
        </tr>
      </thead>

      <tbody ng-hide="isLoading" ng-repeat="row in resultsPaginated">
        <tr>
          <td ng-if="selectedTab !== 'drugs'">
            <button class="btn btn-default" ng-click="row.moreinfo = !row.moreinfo">
              <span ng-if="row.moreinfo" class="glyphicon glyphicon-minus"></span>
              <span ng-if="!row.moreinfo" class="glyphicon glyphicon-plus"></span>
            </button>
          </td>
          <td ng-bind-html="row.gene | mapAttribute : 'geneSymbol' | enumerationWithLink : 'http://www.ncbi.nlm.nih.gov/gene?term=[VALUE]' : true : '\\[VALUE\\]'"></td>
          <td>
            <span ng-if="row.pubchemId.length == 0">{{row.showDrugName}}</span>
            <span ng-if="row.pubchemId.length > 0"><a href="https://pubchem.ncbi.nlm.nih.gov/compound/{{row.pubchemId[0]}}" target="_blank">{{row.showDrugName}}</a></span>
          </td>
          <td>{{row.statusDescription}}</td>
          <td>{{row.therapy ? row.therapy : '' | titlecase | replace:'_':' '}}</td>
          <td>{{row.getSensitivity() | titlecase}}</td>
          <td>
            <div class="tooltipCSS">
              <img ng-if="row.getBestInteraction() == 'marker'" src="images/query/marker-interaction.png"/>
              <img ng-if="row.getBestInteraction() == 'target-direct'" src="images/query/direct-interaction.png"/>
              <img ng-if="row.getBestInteraction() == 'target-indirect'" src="images/query/indirect-interaction.png"/>
              <span ng-if="row.getBestInteraction() == 'marker'" class="tooltiptext">
                <strong>Direct</strong> association in which the altered gene <strong><span style="color:red">T</span></strong>
                is a <strong>biomarker</strong> of the response to drug <strong><span style="color:blue">D</span></strong>
              </span>
              <span ng-if="row.getBestInteraction() == 'target-direct'" class="tooltiptext">
                <strong>Direct</strong> association in which the altered gene <strong><span style="color:red">T</span></strong>
                is the <strong>target</strong> of the drug <strong><span style="color:blue">D</span></strong>
              </span>
              <span ng-if="row.getBestInteraction() == 'target-indirect'" class="tooltiptext">
                <strong>Indirect</strong> association in which the drug <strong><span style="color:blue">D</span></strong>
                has as a <strong>target</strong> a gene <strong><span style="color:gray">T</span></strong> related to the altered one
                <strong><span style="color:red">G</span></strong>
              </span>
            </div>
          </td>
          <td>{{row.family | enumeration}}</td>
          <td>
            <span ng-repeat="source in row.source"><a href="{{source.link}}" target="_blank" title="{{source.name}}" ng-class="row.curatedSource.indexOf(source.name) != -1 ? 'curated_source' : 'non_curated_source'">{{source.shortName}}</a></span>&nbsp;
          </td>
          <td>{{row.dScore | number: 4}}</td>
          <td>{{row.gScore | number: 4}}</td>
          <td>
            <div ng-if="row.dScore > 0.7 && row.gScore > 0.6" class="best-icon">
              <span class="glyphicon glyphicon-star" aria-hidden="true"></span><br/>
            </div>
            <div ng-if="row.getWarnings()" class="warning-icon">
              <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true" title="{{row.getWarnings()}}"></span>
            </div>
          </td>
        </tr>
        <tr ng-repeat-start="genedrug in row.geneDrugInfo" ng-if="row.moreinfo" class="moreinfo">
          <td colspan="{{selectedTab !== 'drugs' ? 5 : 4}}">
            <div ng-if="genedrug.drugStatusInfo.length > 0">{{genedrug.drugStatusInfo}}</div>
            <span ng-if="genedrug.alteration">Alteration: {{genedrug.alteration}}<br></span>
            Find more info for {{genedrug.indirect!=null?(genedrug.drug+" and "+genedrug.indirect.geneInfo.geneSymbol):(genedrug.drug+" and "+getGeneSymbols(genedrug.gene).join())}} in:
            [<a target="_blank" href='http://www.ncbi.nlm.nih.gov/pubmed/?term=&quot;{{genedrug.indirect!=null?(genedrug.drug+"\"+\""+genedrug.indirect.geneInfo.geneSymbol):(genedrug.drug+"\"+\""+getGeneSymbols(genedrug.gene).join())}}&quot;'>PubMed</a>]
            [<a target="_blank" href='https://clinicaltrials.gov/ct2/results?term=&quot;{{genedrug.indirect!=null?(genedrug.drug+"\"+\""+genedrug.indirect.geneInfo.geneSymbol):(genedrug.drug+"\"+\""+getGeneSymbols(genedrug.gene).join())}}&quot;'>ClinicalTrials.gov</a>]
            <br>
          </td>
          <td>{{genedrug.sensitivity | titlecase}}</td>
          <td>
            <div class="tooltipCSS">
              <img ng-if="genedrug.target == 'marker'" src="images/query/marker-interaction.png"/>
              <img ng-if="genedrug.target == 'target' && genedrug.indirect == null" src="images/query/direct-interaction.png"/>
              <img ng-if="genedrug.target == 'target' && genedrug.indirect != null" src="images/query/indirect-interaction.png"/>
              <span ng-if="genedrug.target == 'marker'" class="tooltiptext">
                <strong>Direct</strong> association in which the altered gene <strong><span style="color:red">T</span></strong>
                is a <strong>biomarker</strong> of the response to drug <strong><span style="color:blue">D</span></strong>
              </span>
              <span ng-if="genedrug.target == 'target' && genedrug.indirect == null" class="tooltiptext">
                <strong>Direct</strong> association in which the altered gene <strong><span style="color:red">T</span></strong>
                is the <strong>target</strong> of the drug <strong><span style="color:blue">D</span></strong>
              </span>
              <span ng-if="genedrug.target == 'target' && genedrug.indirect != null" class="tooltiptext">
                <strong>Indirect</strong> association in which the drug <strong><span style="color:blue">D</span></strong>
                has as a <strong>target</strong> a gene <strong><span style="color:gray">T</span></strong> related to the altered one
                <strong><span style="color:red">G</span></strong>
              </span>
            </div>
            <div ng-if="genedrug.target == 'target' && genedrug.indirect != null">
              <button type="button" class="btn btn-sm btn-default seepathways" data-toggle="modal" data-target="#pathways-{{row.showDrugName|replace:' ':'-'}}-{{genedrug.indirect.geneInfo.geneSymbol}}">
                See pathways
              </button>
              <div id = "pathways-{{row.showDrugName|replace:' ':'-'}}-{{genedrug.indirect.geneInfo.geneSymbol}}" class="modal fade">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title">Involved pathways in indirect relation</h4>
                    </div>
                    <div class="modal-body">
                      The following KEGG pathways are those where the target gene of the drug ({{genedrug.indirect.geneInfo.geneSymbol}}) is related
                      to at least one of the altered genes ( <span ng-repeat="alteredGene in genedrug.gene">{{alteredGene.geneSymbol}} </span>)
                      <ul>
                        <li ng-repeat="pathway in genedrug.indirect.pathway">
                          <a target='_blank' href="{{pathway|kegglink:genedrug.indirect.geneInfo}}">{{pathway.name}}</a>
                          ( <span ng-repeat="alteredGene in pathway.gene">{{alteredGene.geneSymbol}} </span>)
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </td>
          <td >{{genedrug.family | enumeration}}</td>
          <td >{{genedrug.source | enumeration}}</td>
          <td>{{genedrug.dScore | number: 4}}</td>
          <td>{{genedrug.gScore | number: 4}}</td>
          <td>
            <div ng-if="genedrug.warning.length > 0" class="warning-icon">
              <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true" title="{{genedrug.warning.join('\n')}}"></span>
            </div>
          </td>
        </tr>
        <tr ng-repeat-end ng-if="row.moreinfo && selectedTab === 'vcfranking'" class="moreinfo" ng-class="{highlightedGeneDrug: genedrug.dScore > 0.7 && genedrug.gScore > 0.6}">
          <td>&nbsp;</td>
          <td colspan="10">
            <div ng-repeat="gene in genedrug.gene">
              <span class="variant-info">Variant information in gene {{gene.geneSymbol}}: {{computations[computationId].affectedGenesInfo[gene.geneSymbol].HGVS_cDNA}} / {{computations[computationId].affectedGenesInfo[gene.geneSymbol].HGVS_protein}}</span>
              <span class="variant-consequence" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].consequence == 'stop_gained'" title="consequence of the variant in gene sequence">stop gained</span>
              <span class="variant-consequence" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].consequence == 'frameshift_variant'" title="consequence of the variant in gene sequence">frameshift variant</span>
              <span class="variant-consequence" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].consequence == 'missense_variant'" title="consequence of the variant in gene sequence">missense variant</span>
              <span class="variant-consequence" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].consequence == 'inframe_insertion'" title="consequence of the variant in gene sequence">inframe insertion</span>
              <span class="variant-consequence" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].consequence == 'inframe_deletion'" title="consequence of the variant in gene sequence">inframe deletion</span>

              <span class="effect-prediction" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].sift_effect.includes('deleterious') || computations[computationId].affectedGenesInfo[gene.geneSymbol].sift_effect == 'inferred'" title="Sift prediction: {{computations[computationId].affectedGenesInfo[gene.geneSymbol].sift_effect}}">S</span>
              <span class="effect-prediction" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].poly_effect == 'probably_damaging' || computations[computationId].affectedGenesInfo[gene.geneSymbol].poly_effect == 'possibly_damaging'  || computations[computationId].affectedGenesInfo[gene.geneSymbol].poly_effect == 'inferred'" title="Polyphen prediction: {{computations[computationId].affectedGenesInfo[gene.geneSymbol].poly_effect}}">P</span>
              <span class="effect-prediction" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].condel_effect == 'deleterious' || computations[computationId].affectedGenesInfo[gene.geneSymbol].condel_effect == 'inferred'" title="Condel prediction: {{computations[computationId].affectedGenesInfo[gene.geneSymbol].condel_effect}}">C</span>

              <span class="cosmic-prediction" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].cosmic_id.includes('PATHOGENIC')" title="Pathogenic variant according to COSMIC">COSMIC</span>
              <span class="clinvar-prediction" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].clinvar_clinical_significance.includes('Pathogenic')" title="Pathogenic variant according to ClinVar">ClinVar</span>
              <span class="gmaf-value" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].GMAF_freq !== '' && computations[computationId].affectedGenesInfo[gene.geneSymbol].GMAF_freq < 1" title="Low GMAF frequency: {{computations[computationId].affectedGenesInfo[gene.geneSymbol].GMAF_freq}}%">GMAF &lt; 1%</span>
              <span class="exac-value" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].ExAC !== '' && computations[computationId].affectedGenesInfo[gene.geneSymbol].ExAC < 1" title = "Low ExAC: {{computations[computationId].affectedGenesInfo[gene.geneSymbol].ExAC}}%">ExAC &lt; 1%</span>
              <span class="affected-domain" ng-if="computations[computationId].affectedGenesInfo[gene.geneSymbol].interpro != ''" title="Interpro affected domain">{{computations[computationId].affectedGenesInfo[gene.geneSymbol].interpro}}</span>
            </div>
          </td>
        </tr>

      </tbody>
      <tfoot ng-hide="isLoading">
        <tr id="pagination-footer">
          <td colspan="10" class="text-center">
            <div class="form-group row">
              <label class="col-xs-push-5 col-xs-1 control-label">items per page</label>
              <div class="col-xs-push-5 col-xs-1">
                <select ng-model="itemsperpage" class="form-control" ng-init="itemsperpage = paginationOptions[1]" ng-options="option for option in paginationOptions">

                </select>
              </div>
            </div>

              <div st-pagination="" st-items-by-page="itemsperpage" st-displayed-pages="4"></div>
            </td>
        </tr>
      </tfoot>

      <tbody ng-hide="!isLoading">
        <tr>
          <td colspan="10">Loading...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
