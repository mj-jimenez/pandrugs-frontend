<div>
<button type="submit" class="btn btn-success btn-lg" ng-show="results!=null" ng-click="newQuery()" style="float:right">New Query</button>
<h2>Query PandrugsDB: Genes</h2>

</div>

<form role="query form">
  <div class="container-fluid">
    <div class="row"  id="genequeryform" ng-show="results==null">
    <div class="col-md-6">
  <div class="form-group">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h4 class="panel-title">
          Genes
      </h4>
    </div>
    <textarea name="genes" class="form-control" id="genestextarea" placeholder="Enter HUGO Gene symbols" ng-model="genes" rows="20"></textarea>
  </div>
  </div>
  </div>
  <div class="col-md-6">
  <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#/query#advanced" aria-expanded="true" aria-controls="advanced">
          Advanced Options
        </a>
      </h4>
    </div>
    <div id="advanced" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
      
      <!-- drug and status level-->
      <div class="panel panel-default">      
	<div class="panel-heading">Drug status level</div>
	<div class="panel-body">
	
	  <h4>Cancer</h4>	
	    <label><input type="checkbox" ng-model="queryCancerFda">FDA approved</label>
	    <label><input type="checkbox" ng-model="queryCancerClinical">Clinical trials</label>	
	  <h4>Other pathologies</h4>	
	    <label><input type="checkbox" ng-model="queryOtherFda">FDA approved</label>	
	    <label><input type="checkbox" ng-model="queryOtherClinical">Clinical trials</label>	
	    <label><input type="checkbox" ng-model="queryOtherExperimental">Experimental</label>
	  
	</div><!-- end panel-body -->
      
      </div><!-- end drug and status level -->
     
      
      <!-- interaction evidence level -->
      <div class="panel panel-default">      
	<div class="panel-heading">Interaction evidence level</div>
	<div class="panel-body">
	    <label><input type="checkbox" ng-model="queryTarget">Target</label>
	
	    <label><input type="checkbox" ng-model="queryMarker">Marker</label>
	</div><!-- end panel-body -->
      </div><!-- end  interaction evidence level -->
      
      <!-- drug-target relation -->
      <div class="panel panel-default">      
	<div class="panel-heading">Drug-target relation</div>
	<div class="panel-body">
	    <label><input type="checkbox" ng-model="queryDirect">Direct</label>
	
	    <label><input type="checkbox" ng-model="queryIndirect">Indirect</label>
	</div><!-- end panel-body -->
      </div><!-- end  interaction evidence level -->
      
      </div>
    </div>
  </div>
  </div>
  </div>
</div>


  <button type="submit" class="btn btn-primary btn-lg" ng-show="results==null" ng-click="query()" ng-disabled="genes.length==0 || isLoading || (!queryCancerFda && !queryCancerClinical && !queryOtherClinical && !queryOtherExperimental && !queryOtherFda) || (!queryTarget && !queryMarker) || (!queryDirect && !queryIndirect)">Query</button>
  
</form>


<div class="container-fluid" ng-if="results!=null && results.length != 0">

  <highchart id="chart1" config="highchartsBubble" style="margin-top:20px"></highchart>

<table id="results" st-table="results" st-pipe="query" class="table table-striped">
	<thead>
	<tr>
		<th>Actions</th>
		<th>Gene(s)</th>
		<th>Drug</th>
		<th>Family</th>
		<th>Source(s)</th>
		<th>Status</th>
		<th>Cancer</th>
		<th st-sort="therapy">Type of therapy</th>
		<th>Indirect</th>
		<th>Target</th>
		<th st-sort="dScore">DScore</th>
		<th st-sort="gScore">GScore</th>
	</tr>
	</thead>
	<tbody ng-hide="isLoading" ng-repeat="row in results">
	<tr>
		<td>
		<button class="btn btn-default" ng-click="row.moreinfo=!row.moreinfo">
		  
		  <span ng-show="row.moreinfo" class="glyphicon glyphicon-minus"></span>
		  <span ng-show="!row.moreinfo" class="glyphicon glyphicon-plus"></span>
		</button></td>
		<td>{{row.gene.join(', ')}}</td>
		<td>{{row['show-drug-name']}}</td>
		<td>{{row.family.join(', ')}}</td>
		<td>
		<span ng-repeat="source in row.source"><a href="{{source.link}}" ng-class="{'curated': row['curated-source'].indexOf(source.name) != -1 }">{{source.name}}</a>{{$last? '': ', '}} </span>
		</td>
		<td>{{row.status}}</td>
		<td>{{row.cancer}}</td>
		<td>{{row.therapy}}</td>
		<td>{{row['indirect-gene'].join(', ')}}</td>
		<td>{{row.target?'yes':'-'}}</td>
		<td>{{row.dScore | number: 4}}</td>
		<td>{{row.gScore | number: 4}}</td>		
	</tr>	
	<tr ng-repeat="genedrug in row['gene-drug-info']" ng-show="row.moreinfo" class="moreinfo">
	  <td>&nbsp;</td>
	  <td colspan="2">
	   <div ng-show="{{genedrug.drugStatusInfo.length>0}}">{{genedrug.drugStatusInfo}}</div>
	    <b>{{genedrug.gene.join(', ')}}</b><br>
	    PubMed Link: 
	    <a target="_blank" href='http://www.ncbi.nlm.nih.gov/pubmed/?term=&quot;{{genedrug.indirect!=null?(genedrug.drug+"\"+\""+genedrug.indirect):(genedrug.drug+"\"+\""+genedrug.gene.join())}}&quot;'>{{genedrug.indirect!=null?(genedrug.drug+'+'+genedrug.indirect):(genedrug.drug+'+'+genedrug.gene.join())}}</a>
	    
	    <br>
	    Sensitivity: {{genedrug.sensitivity}} <br>
	    Alteration: {{genedrug.alteration}}
	  </td>
	  <td >{{genedrug.family}}</td>
	  <td >{{genedrug.source.join(', ')}}</td>
	  <td colspan="3">&nbsp;</td>
	  <td >{{genedrug.indirect!=null? genedrug.indirect : ''}}</td>
	  <td >{{genedrug.target}}</td>
	  <td >{{genedrug.dScore | number: 4}}</td>
	  <td >{{genedrug.gScore | number: 4}}</td>
	</tr>
	</tbody>
	
	<tbody ng-hide="!isLoading">
	<tr>
	<td colspan="10">Loading...</td>
	</tr>
	</tbody>
</table>

</div>
</div>

